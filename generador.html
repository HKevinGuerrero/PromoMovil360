<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Generador de Afiche | Promo Móvil 360</title>
  <link rel="icon" type="image/png" href="imagenes/logo.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .step-indicator { transition: all 0.3s ease; }
    .step-indicator.active { background: linear-gradient(135deg, #C8A750, #AF8D36); color: white; }
    .step-indicator.completed { background: #10b981; color: white; }
    .upload-zone { border: 3px dashed #C8A750; transition: all 0.3s; }
    .upload-zone:hover { border-color: #AF8D36; background: #fef9e7; }
    .upload-zone.dragover { border-color: #AF8D36; background: #fef3c7; }
    .preview-afiche { background: linear-gradient(135deg, #f8f9fa, #e9ecef); border: 2px solid #C8A750; box-shadow: 0 10px 30px rgba(0,0,0,0.15); position: relative; overflow: hidden; }
    .preview-afiche::before { content: 'VISTA PREVIA'; position: absolute; top: 10px; right: 10px; background: rgba(200,167,80,0.9); color: white; padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: bold; z-index: 10; }
    .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #C8A750; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="bg-gray-50">

  <!-- Header -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-3">
        <img src="imagenes/logo.jpg" alt="Logo" class="h-12 w-12 rounded-full">
        <h1 class="text-xl font-bold text-gray-800">Generador de Afiche</h1>
      </a>
      <a href="index.html" class="text-gray-600 hover:text-gray-900">
        <i class="fas fa-times text-xl"></i>
      </a>
    </div>
  </header>

  <!-- MAIN -->
  <main class="max-w-6xl mx-auto px-4 py-8">
    <div class="grid md:grid-cols-2 gap-8">
      
      <!-- Panel Izquierdo -->
      <div class="bg-white rounded-2xl shadow-xl p-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">
          <i class="fas fa-image text-yellow-600"></i> Crear Afiche
        </h2>
        <p class="text-gray-600 mb-4">Sube tu logo, escribe tu texto promocional y genera un afiche automáticamente.</p>

        <label class="block text-sm font-bold text-gray-700 mb-2">Logo (opcional)</label>
        <input type="file" id="logoInput" accept="image/*" class="mb-4 w-full">

        <label class="block text-sm font-bold text-gray-700 mb-2">Texto de Promoción *</label>
        <textarea id="promoText" rows="3" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-500 focus:outline-none" placeholder="Ej: 20% de descuento en toda la carta"></textarea>

        <button id="generateBtn" class="mt-6 w-full bg-gradient-to-r from-yellow-500 to-orange-500 text-white font-bold py-3 rounded-xl hover:shadow-lg transition">
          <i class="fas fa-wand-magic-sparkles"></i> Generar Afiche con DeepAI
        </button>
      </div>

      <!-- Panel Derecho -->
      <div class="bg-white rounded-2xl shadow-xl p-8 sticky top-24 self-start">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Vista Previa del Afiche</h3>
        <div id="affichePreview" class="preview-afiche aspect-[3/4] rounded-xl p-8 flex flex-col items-center justify-center">
          <div id="loadingState" class="text-center">
            <i class="fas fa-image text-6xl text-gray-400 mb-4"></i>
            <p class="text-gray-500">Tu afiche aparecerá aquí</p>
          </div>
          <div id="generatingState" class="hidden text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-gray-700 font-semibold">Generando afiche...</p>
          </div>
          <div id="previewContent" class="hidden w-full h-full flex flex-col"></div>
        </div>
      </div>

    </div>
  </main>

<script>
  // === API Key de DeepAI ===
  const DEEPAI_API_KEY = "37752c93-f809-48c7-9b54-5971ba8ffd19"; // <- Pega aquí tu clave de https://deepai.org/api-key

  const generateBtn = document.getElementById('generateBtn');
  const promoText = document.getElementById('promoText');
  const logoInput = document.getElementById('logoInput');

  const loadingState = document.getElementById('loadingState');
  const generatingState = document.getElementById('generatingState');
  const previewContent = document.getElementById('previewContent');

  generateBtn.addEventListener('click', async () => {
    const text = promoText.value.trim();
    if (!text) {
      alert('Por favor escribe el texto de la promoción');
      return;
    }

    loadingState.classList.add('hidden');
    generatingState.classList.remove('hidden');
    previewContent.classList.add('hidden');

    try {
      const form = new FormData();
      form.append('text', `Crea un afiche publicitario moderno, vertical (3:4) con colores cálidos y texto promocional: ${text}`);

      const response = await fetch('https://api.deepai.org/api/text2img', {
        method: 'POST',
        headers: { 'api-key': DEEPAI_API_KEY },
        body: form
      });

      const data = await response.json();
      if (!response.ok || !data.output_url) {
        throw new Error(`Error DeepAI: ${JSON.stringify(data)}`);
      }

      const imageUrl = data.output_url;
      renderImage(imageUrl);

    } catch (error) {
      console.error('Error al generar:', error);
      alert('Error al generar el afiche: ' + error.message);
      generatingState.classList.add('hidden');
      loadingState.classList.remove('hidden');
    }
  });

  function renderImage(url) {
    previewContent.innerHTML = `
      <div class="w-full h-full relative">
        <img src="${url}" class="w-full h-full object-cover rounded-xl" alt="Afiche generado">
        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-white/95 backdrop-blur rounded-full px-6 py-2 shadow-lg">
          <p class="text-xs font-black text-gray-800">Generado con DeepAI</p>
        </div>
      </div>
    `;
    generatingState.classList.add('hidden');
    previewContent.classList.remove('hidden');
  }
</script>

</body>
</html>
